!function(){"use strict";angular.module("greenspotStall",["ngMaterial","ngMessages"]).config(["$locationProvider","$mdThemingProvider","$mdIconProvider",function(e,o,t){o.theme("default").primaryPalette("teal").accentPalette("lime"),t.defaultIconSet("/static/img/icon/core-icons.svg",24)}])}(),function(){"use strict";var e=angular.module("greenspotStall");e.directive("googleplace",function(){return{scope:{addrObj:"=addressObject",placeOnSelect:"&"},link:function(e,o,t,r){var s={types:["address"],componentRestrictions:{country:"nz"}};e.googlePlaceAutocomplete=new google.maps.places.Autocomplete(o[0],s),google.maps.event.addListener(e.googlePlaceAutocomplete,"place_changed",function(){e.$apply(function(){e.addrObj=e.googlePlaceAutocomplete.getPlace()}),e.placeOnSelect()})}}})}(),function(){"use strict";function e(e,t,r){var s=this;s.gotoUrl=function(e){window.location.href=e},s.init=function(){s.cart.loadFromCookie()},s.cart={stls:[],qty:0,selectStall:function(e){s.order.stall=e},add:function(e){this.qty++;var t=!1;if($.each(this.stls,function(o,r){return r.i==e.stallId?(t=!0,r.add(e),!1):void 0}),!t){var r=new o(e.stallId,e.stallName);r.add(e),this.stls.push(r)}this.writeToCookie()},empty:function(){this.stls=[],this.qty=0,Cookies.remove("cart")},remove:function(e,o){if(this.qty-=e.remove(o),0==e.itms.length){var t=this.stls.indexOf(e);t>-1&&this.stls.splice(t,1)}this.writeToCookie()},plusOne:function(e,o){e.plusOne(o),this.qty++,this.writeToCookie()},minusOne:function(e,o){e.minusOne(o),this.qty--,this.writeToCookie()},loadFromCookie:function(){var e=Cookies.get("cart");if(e){var t=$.parseJSON(e);this.stls=[],$.each(t.stls,function(e,t){var r=new o(t.i,t.n);r.qty=t.qty,r.amt=t.amt,r.itms=t.itms,s.cart.stls.push(r)}),this.qty=t.qty,s.order.stall=s.cart.stls[0]}},writeToCookie:function(){Cookies.set("cart",this,{expires:14})}},s.checkOut=function(){e.post("/customer/CheckStock",s.order).success(function(e){e.Succeeded?window.location.href="/customer/Checkout":console.log(e.Message)}).error(function(e){console.log(e)})},s.init_checkout=function(e){s.order=e,s.loadDeliveryAddress(s.loadDeliverySchedule)},s.init_address=function(){s.loadDeliveryAddress()},s.order={},s.loadDeliveryAddress=function(o){e.get("/customer/DeliveryAddresses").success(function(e){e.Succeeded?(s.deliveryAddresses=e.Data,s.order.deliveryAddress=s.deliveryAddresses[0],o&&o()):console.log(e.Message)}).error(function(e){console.log(e)})},s.loadDeliverySchedule=function(){var o="/api/stall/DeliverySchedule/"+s.order.stall.i+"?country="+s.order.deliveryAddress.CountryId;o+="&city="+s.order.deliveryAddress.City,o+="&area="+s.order.deliveryAddress.Area,e.get(o).success(function(e){e.Succeeded?(s.deliverySchedule=e.Data,s.order.deliveryOption=s.deliverySchedule[0],s.SelectDeliveryOption()):(r.alert(e.Message),console.log(e.Message))}).error(function(e){console.log(e)})},s.getDeliveryFee=function(){if(s.order.deliveryFee=null,s.order.deliveryOption.IsPickUp)s.order.deliveryFee=0,s.order.amount=s.order.stall.amt+s.order.deliveryFee;else{var o="/api/stall/CalcDeliveryFee/"+s.order.stall.i+"?country="+s.order.deliveryAddress.CountryId;o+="&city="+s.order.deliveryAddress.City,o+="&suburb="+s.order.deliveryAddress.Suburb,o+="&amount="+s.order.stall.amt,e.get(o).success(function(e){e.Succeeded?(s.order.deliveryFee=e.Data,s.order.amount=s.order.stall.amt+s.order.deliveryFee):(r.alert(e.Message),console.log(e.Message))}).error(function(e){console.log(e)})}},s.SelectDeliveryAddress=function(){s.loadDeliverySchedule()},s.SelectDeliveryOption=function(){s.getDeliveryFee()},s.newAddress={},s.addressSelected=function(){s.newAddress.Address=s.newAddress.AddressObject.formatted_address},s.addressChanged=function(){s.newAddress.AddressObject=null},s.addAddress=function(){return s.newAddress.AddressObject?void e.post("/customer/addAddress",s.newAddress).success(function(e){e.Succeeded?s.loadDeliveryAddress():console.log(e.Message)}).error(function(e){console.log(e)}):void alert("请确认地址")},s.pay=function(){console.log(s.order),e.post("/customer/Pay",s.order).success(function(e){e.Succeeded?(console.log(e),window.location.href=e.Data):console.log(e.Message)}).error(function(e){console.log(e)})},s.fakePay=function(){console.log(s.order),e.post("/customer/fakePay",s.order).success(function(e){e.Succeeded?(console.log(e),window.location.href=e.Data):console.log(e.Message)}).error(function(e){console.log(e)})}}function o(e,o){var t=this;t.i=e,t.n=o,t.qty=0,t.amt=0,t.itms=[],t.add=function(e){t.qty++,t.amt+=e.price;var o=!1;$.each(t.itms,function(t,r){return r.i==e.id?(r.q++,o=!0,!1):void 0}),o||t.itms.push({i:e.id,n:e.name,v:e.variant,q:1,p:e.price})},t.remove=function(e){var o=0;return $.each(t.itms,function(r,s){if(s.i==e){var n=t.itms.indexOf(s);return n>-1&&t.itms.splice(n,1),o=s.q,t.qty-=s.q,t.amt-=s.p*s.q,!1}}),o},t.plusOne=function(e){$.each(t.itms,function(o,r){r.i==e&&r.q<99&&(r.q++,t.qty++,t.amt+=r.p)})},t.minusOne=function(e){$.each(t.itms,function(o,r){r.i==e&&r.q>0&&(r.q--,t.qty--,t.amt-=r.p)})}}var t=angular.module("greenspotStall");t.controller("CustomerController",e),e.$inject=["$http","$location","$window"]}(),function(){"use strict";function e(e,o){var t=this;t.gotoUrl=function(e){window.location.href=e},t.Register=function(){e.post("/owner/Register",this.OwnerInfo).success(function(e){e.Succeeded?window.location.href=e.Data:console.log(e.Message)}).error(function(e){console.log(e)})}}var o=angular.module("greenspotStall");o.controller("OwnerController",e),e.$inject=["$http","$location"]}();